# Epitaph – Burp goal tracker

An extensible Burp Suite extension (Jython) that shows goal completion per host with a tinted hostname row and a progress bar. It records what kinds of tests have been observed, lets you mark manual checks, and exports a JSON record that is richer than a .har.

## What it does
- Adds an **Epitaph** tab with a host table tinted by completion: light red (<20%), yellow (>20%), green (≥90%) plus a progress bar column.
- Tracks default goals per host and updates them automatically from traffic:
  - Injection markers seen (`< > " '` in params/body)
  - State-changing method seen (POST/PUT/PATCH/DELETE)
  - Authentication surface touched (paths containing auth/login/signin/oauth/sso/mfa)
  - Error path captured (non-2xx response)
  - Manual creative testing (toggle yourself)
- Shows a per-host goal checklist; you can override any goal manually.
- Exports JSON to `epitaph-report.json` (path configurable) and saves a final snapshot when the extension unloads.

## Install
1) Ensure Burp can run Python extensions (e.g., set the Jython standalone jar in Extender → Options → Python Environment).  
2) In Extender → Extensions, add a new extension:
   - Type: `Python`
   - Extension file: `epitaph.py`
3) Open the **Epitaph** tab to view hosts as you proxy traffic.

## Using it
- Trigger goals by sending requests to a host; detection is automatic based on the defaults above.  
- Select a host row to see the goal checklist; toggle any item to mark/unmark manual work.  
- Leave **Scope only** checked to hide and ignore out-of-scope traffic based on Burp's Target scope (default on).  
- On load, Epitaph hydrates from the current Burp Proxy history so previously captured traffic is reflected immediately.  
- Click **Export JSON** to write the current state; change the path in the text field if desired. A final export runs when Burp unloads the extension.

### Color scheme
- Light red: incomplete/error (<20% goals complete)  
- Yellow: >20% goals complete  
- Green: ≥90% goals complete  
All fills are semi-translucent so the hostname text remains readable.

## JSON output
The export contains per-host progress, goal metadata, and request/response counts. Example:

```json
{
  "exported_at": "2024-04-11T15:04:03Z",
  "profile": "Default Injection Coverage",
  "host_count": 1,
  "hosts": [
    {
      "host": "app.example.com",
      "progress_percent": 60,
      "stats": {
        "requests_observed": 42,
        "responses_observed": 42,
        "goals_done": 3,
        "goals_total": 5
      },
      "goals": [
        {
          "key": "inject_special_chars",
          "name": "Injection markers seen",
          "complete": true,
          "automatic": true,
          "last_updated": "2024-04-11T15:00:00Z"
        }
      ]
    }
  ],
  "notes": "Generated by Epitaph Burp extension. Values represent observed test coverage per host."
}
```

## Extending goals
- Edit `_build_profile` in `epitaph.py` to add or change `GoalDefinition` entries.  
- Each goal can include a detector: a callable `(host_progress, messageInfo, request_info, response_info, is_request) -> bool` that returns `True` when the goal should be marked complete.  
- Detectors run for every HTTP message, so keep them quick and side-effect free.

### Custom goals via template file
- In the Epitaph toolbar, set a `Template path` (defaults to `epitaph-goals.csv`) and click **Load Goals**. Default automatic goals stay enabled; your custom goals are added as manual checklist items.
- CSV/TSV/pipe files with an optional header `key,name,description,category` are supported. Example:
  ```
  key,name,description,category
  client_side_logic,Client-side logic reviewed,JS-heavy flows exercised,manual
  rate_limits,Rate limits probed,Checked throttling on sensitive endpoints,manual
  ```
- Plain text also works: each non-empty line becomes a goal. Use `key|name|description|category` or just the goal name (which fills name and description).
- If a row reuses a default goal key, only that goal's label/description/category are updated; its detector stays active.

## Notes
- Progress is tracked per-host. Hosts appear in the table as soon as traffic is seen.  
- The extension tints the hostname cell and uses a progress bar column to show completion at a glance.  
- If you want a different export location by default, adjust the path set in `_build_ui`.
